var CommonPlatform={defaultPageName:null,endpoints:["/magellan-ws/resources/navigationentries/standalone"],initialize:function(a){if(typeof(a)=="object"){if(a.defaultPageName&&typeof(a.defaultPageName)=="string"){CommonPlatform.defaultPageName=a.defaultPageName}if(a.handler&&typeof(a.handler)=="function"){Messenger.initialize(a.handler)}if(a.standalone&&typeof(a.standalone)=="boolean"&&a.standalone==true){CommonContext.standalone=a.standalone;ChannelManager.commtype="standalone";Authenticator.authenticateByCookies();if(a.header&&typeof(a.header)=="boolean"&&a.header==true||a.header==null){$("body").prepend(Header().prepend(InstitutionalBranding()).prepend(UserControls()));ChannelManager.initialize();Theme.load();HelpManager.initialize();if(a.globalNav&&typeof(a.globalNav)=="boolean"&&a.globalNav==true||a.globalNav==null){addNavigationControls()}}ContentManager.initialize();if(a.footer&&typeof(a.footer)=="boolean"&&a.footer==true||a.footer==null){Footer.initialize();OpenItems.initialize()}Localization.initialize();ResourceManager.addResourceBundle("common-platform");ContentManager.calculateContentHeight()}else{Bootstraper.add(function(){$("body").prepend(Header().prepend(InstitutionalBranding()).prepend(UserControls()).prepend(SearchBox()));addNavigationControls();var b=XMLHelper.getElementData(XMLHelper.getFirstChild(CommonContext.udcIdentity,"PersonName"),"LegalName");var c=XMLHelper.getElementData(XMLHelper.getFirstChild(CommonContext.udcIdentity,"PersonName"),"GivenName");$(".userIdentityText").text(c+" "+b)});Bootstraper.add(Theme.load);Bootstraper.add(WorkspaceManager.initialize);Bootstraper.add(FragmentManager.initialize);Bootstraper.add(ChannelManager.initialize);Bootstraper.add(Navigation.initialize);Bootstraper.add(Footer.initialize);Bootstraper.add(OpenItems.initialize);Bootstraper.add(ContentManager.initialize);Bootstraper.add(HelpManager.initialize);Bootstraper.add(Localization.initialize);EventDispatcher.addEventListener(Authenticator.events.authorizationComplete,Bootstraper.go);Authenticator.authorizeByUDCID();ResourceManager.addResourceBundle("common-platform")}}}};var Authenticator={endpoints:{index:-1,authorize:[]},events:{authorizationComplete:"authorizationComplete"},authenticateByCookies:function(){var a=CookieManager.get("username");if(a){CommonContext.user=a}},authorizeByUDCID:function(){var a=CookieManager.get("udcid");Authenticator.endpoints.index+=1;if(a){ServiceManager.get(Authenticator.endpoints.authorize[Authenticator.endpoints.index].replace(":udcid",a),function(c){if(!c){return}if(c.status){if(c.status==404||c.status==500){Authenticator.authorizeByUDCID();return}}CommonContext.user=XMLHelper.getElementData(c,"LogonID");CommonContext.pidm=XMLHelper.getElementData(c,"BannerInternalID");CommonContext.udcid=XMLHelper.getElementData(c,"UDCIdentifier");CommonContext.udcIdentity=XMLHelper.getFirstChild(c,"UDCIdentity");var d=XMLHelper.getChildren(c,"institutionrole");var e="";var f=true;for(var b=0;b<d.length;b++){e+=(f?"":",")+XMLHelper.getElementData(d[b],"role");f=false}CommonContext.roles=e;EventDispatcher.dispatchEvent(Authenticator.events.authorizationComplete)})}}};var Bootstraper={functions:[],add:function(a){Bootstraper.functions.push(a)},go:function(){for(var a=0;a<Bootstraper.functions.length;a++){if(typeof(Bootstraper.functions[a])=="function"){Bootstraper.functions[a]()}}}};var CommonContext={user:null,udcid:null,pidm:null,roles:"",udcIdentity:null,locale:"fr",standalone:false};var ChannelManager={commtype:"hash",channels:[],supportedChannels:["hash","xdm","standalone"],supportsXDM:false,initialize:function(){if(window.postMessage){ChannelManager.commtype="xdm";ChannelManager.supportsXDM=true;if(window.addEventListener){window.addEventListener("message",function(a){MessageProcessor.processMessage(decodeURIComponent(encodeURIComponent(a.data)))},false)}else{window.attachEvent("onmessage",function(a){MessageProcessor.processMessage(decodeURIComponent(encodeURIComponent(a.data)))},false)}}else{ChannelManager.commtype="hash"}},addChannel:function(a,b){this.channels[a]=b},send:function(b,a){switch(this.commtype){case"hash":if(typeof(b)!="string"){b=Messenger.xml2string(b)}$("#"+a).attr("src",this.channels[a]+"#"+Messenger.encode(b));break;case"standalone":Messenger.messageHandler(b);break;case"xdm":this.sendCrossDocumentMessage(b,a);break;default:ErrorManager.show("No communication method has been defined.");break}},sendCrossDocumentMessage:function(b,a){var c=document.getElementById(a).contentWindow;c.postMessage(b,"*")}};var MessageProcessor={checkForHelpMessage:function(a){var b=false;$(a).find("help").find("url").each(function(c){HelpManager.showHelpByURL($(this).text());b=true});return b},checkForErrorMessage:function(a){var b=[];var e=[];var g=false;$(a).find("errors").find("error").each(function(h){b[h]=$(this).find("code").text();e[h]=$(this).find("message").text();g=true});var c="";if(g&&e.length>0){var f=[];$(e).each(function(h){msg=e[h];if(b[h]){msg+=" ("+b[h]+")"}c+="<span class='errorMessage'>"+msg+"</span>"});var d=[Button("errorOkButton","common_ok",ModalWindowFactory.close,"blue")];ModalWindowFactory.show("errorWindowModal","errorwindow_label_title","blue",$(c),"errorWindowContent",d,null);b=[];e=[]}return g},checkForRequestMessage:function(a){var e=false;if($(a).find("request").length>0){var c=$(a).find("request").text();var b=null;var d=null;if($("li.activeOpenItem").length>0){b=$("li.activeOpenItem").attr("id").replace(OpenItems.openItemMarker,"");d=OpenItems.findAnyOpenItemByName(b)}switch(c){case"navigate":ChannelManager.send(createApplicationPageNavigationMessage(d.context.pageName),b);break;case"context":if(CommonContext.standalone){if(typeof(Messenger.messageHandler)=="function"){Messenger.messageHandler(createContextMessage({pageName:CommonPlatform.defaultPageName}))}}else{ChannelManager.send(createContextMessage(d.context),b)}break;default:break}e=true}return e},checkForConfirmationMessage:function(b){var h=false;if(b.getElementsByTagName("confirmation").length>0){var e=XMLHelper.getElementData(b.getElementsByTagName("confirmation")[0],"message");var g=XMLHelper.getElementData(b.getElementsByTagName("confirmation")[0],"title");var f=b.getElementsByTagName("confirmation")[0].getElementsByTagName("response");var d=[];var c="_responseSelected";for(var a=0;a<f.length;a++){d.push(Button(f[a].getAttribute("responseValue")+c,f[a].getAttribute("label"),function(){MessageProcessor.sendConfirmationResponse($(this).attr("id").replace(c,""));ModalWindowFactory.close()},"blue"))}ModalWindowFactory.show("confirmationWindowModal","confirmation_label_title","blue",e,"",d,null);h=true}return h},checkForStatusMessage:function(a){var b=false;$(a).find("status").find("message").each(function(c){b=true});return b},checkForUdcIdentityMessage:function(a){var b=false;if(!a||!a.getElementsByTagName("UDCIdentity")[0]){return b}b=true;CommonContext.udcIdentity=a;CommonContext.udcid=XMLHelper.getElementData(a,"UDCIdentifier");return b},checkForOpenItemMessage:function(a){var e=false;if(!a||!a.getElementsByTagName("context")[0]){return false}var b=XMLHelper.getElementData(a.getElementsByTagName("context")[0],"appid");if($(a).find("openitem").length>0){var d=XMLHelper.getElementData(a.getElementsByTagName("openitem")[0],"action");var c=XMLHelper.getElementData(a.getElementsByTagName("openitem")[0],"page");switch(d){case"open":OpenItems.addApplicationPage(b,c);break;case"close":OpenItems.removeApplicationPage(b,c);break;default:break}e=true}return e},checkForNavigationMessage:function(a){var c=false;if(a.getElementsByTagName("navigate").length>0){var b=XMLHelper.getElementData(a.getElementsByTagName("navigate")[0],"location");if(b){Navigation.navigate(b,null)}c=true}return c},checkForUdcIdMessage:function(a){var b=false;if(a.getElementsByTagName("udcIdentity").length>0){getUDCXml(XMLHelper.getElementData(a,"identity"));b=true}return b},sendConfirmationResponse:function(a){if(CommonContext.standalone){if(typeof(Messenger.messageHandler)=="function"){Messenger.messageHandler(createConfirmationResponseMessage(a))}}else{if($("li.activeOpenItem").length>0){var b=$("li.activeOpenItem").attr("id").replace(OpenItems.openItemMarker,"");ChannelManager.send(createConfirmationResponseMessage(a),b)}}},checkForServiceCallMessage:function(a){var c=false;if(a.firstChild.childNodes.length>0&&a.firstChild.childNodes[0].nodeName=="service"){function b(d){var e=null;var f=(new XMLSerializer()).serializeToString(d);ChannelManager.send(f,e)}alert("service call progress");ServiceManager.get($(a).find("url").text(),b);c=true}return c},processMessage:function(a){a=Messenger.decode(a);xmldoc=Messenger.string2xml(a);if(this.checkForHelpMessage(xmldoc)||this.checkForErrorMessage(xmldoc)||this.checkForStatusMessage(xmldoc)||this.checkForConfirmationMessage(xmldoc)||this.checkForNavigationMessage(xmldoc)||this.checkForRequestMessage(xmldoc)||this.checkForOpenItemMessage(xmldoc)||this.checkForUdcIdentityMessage(xmldoc)||this.checkForUdcIdMessage(xmldoc)||this.checkForServiceCallMessage(xmldoc)){alert(a);return}else{this.broadcast(a)}},broadcast:function(a){$("#content > iframe").each(function(b){ChannelManager.send(a,$(this).attr("name"))});if(typeof(messageHandler)=="function"){messageHandler(a)}}};var ServiceManager={get:function(a,b){this.ajax("GET",a,null,b)},put:function(a,b,c){this.ajax("PUT",a,b,c)},post:function(a,b,c){this.ajax("POST",a,b,c)},remove:function(a,b,c){this.ajax("DELETE",a,b,c)},ajax:function(b,c,e,f){var d=null;if(window.XMLHttpRequest){d=new XMLHttpRequest()}else{if(window.ActiveXObject){d=new ActiveXObject("Microsoft.XMLHTTP")}}if(d!=null){d.onreadystatechange=a;d.open(b,c,true);d.send(e)}else{ErrorManager.show("Your browser does not support XMLHTTP.")}function a(){if(d.readyState==4){if(d.status==200){if(f&&typeof(f)==="function"){if(d.responseXML){f(d.responseXML)}else{f(d.responseText)}}}else{if(f&&typeof(f)==="function"){f(d)}}}}}};var FragmentManager={handlers:[],currentFragment:"",pollIntervalId:null,initialize:function(){FragmentManager.addHandler(a);function a(g){if(g.indexOf("/")!==-1){var c=g.substring(g.lastIndexOf("/")+1);if(c.length>4&&c.substring(0,4)===ContentManager.commonUIPlatformMarker){g=g.substring(0,g.lastIndexOf("/"));var f=Navigation.findNavigationEntry(g);if(!f){return}var b=f.name+"_"+c;if(OpenItems.isOpen(b)){ContentManager.bringToFront(b)}else{var e=OpenItems.findAnyOpenItemByName(b);if(e instanceof OpenItemValueObject){ContentManager.bringToFront(e.navigationEntry.name)}else{var d=new ContextValueObject();if(f.page&&f.page!==""){d.pageName=f.page}Navigation.navigate(g,null)}}}else{var f=Navigation.findNavigationEntry(g);if(!f){return}var d=new ContextValueObject();if(f.page&&f.page!==""){d.pageName=f.page}Navigation.navigate(f,d)}}}},startPolling:function(){if(FragmentManager.pollIntervalId){return}FragmentManager.pollIntervalId=setInterval(FragmentManager.poll,250)},stopPolling:function(){if(FragmentManager.pollIntervalId){clearInterval(FragmentManager.pollIntervalId)}},addHandler:function(a){if(a&&typeof(a)==="function"){FragmentManager.handlers.push(a);FragmentManager.startPolling()}},poll:function(){var b=FragmentManager.get();if(b){b=FragmentManager.sanitize(b);if(b==FragmentManager.currentFragment){return}else{for(var a=0;a<FragmentManager.handlers.length;a++){if(typeof(FragmentManager.handlers[a])==="function"){FragmentManager.handlers[a](b)}}}}},sanitize:function(a){a=a.replace(/\%20/g," ");return a},set:function(a){if(a===FragmentManager.currentFragment){return}else{FragmentManager.currentFragment=a}var b=window.location.hash;if(b){b=b.substr(1);if(b===a){return}else{window.location.hash=a}}else{window.location.hash=a}},get:function(){var a=window.location.hash;if(a){return a.substr(1)}return null}};var Localization={events:{localeChange:"localeChange"},defaultLocale:"en",initialize:function(){var a=CookieManager.get("locale");a=!CookieManager.get("locale")?"en":CookieManager.get("locale").substr(0,2);if(a){CommonContext.locale=a}else{CommonContext.locale=Localization.defaultLocale}Localization.setLocale(CommonContext.locale)},setLocale:function(a){CommonContext.locale=a;ResourceManager.setLocale(a);var b="ltr";if(a.substr(0,2)=="ar"){b="rtl"}Localization.setLangDirection(b)},setLangDirection:function(a){if(a=="ltr"||a=="rtl"){if(Localization.getLangDirection()!=a){$("html").css("direction",a);Localization.loadStyles()}}},getLangDirection:function(){if(!$("html").css("direction")){return"ltr"}return $("html").css("direction")},toggleFloatDirection:function(){$("*:not(#prefWindow > div):not(#errorWindow > div)").each(function(a){if($(this).css("float")){if($(this).css("float")=="right"){$(this).css("float","left")}else{if($(this).css("float")=="left"){$(this).css("float","right")}}}})},loadStyles:function(){if(typeof cssFiles=="undefined"||cssFiles.length==0){var c=document.styleSheets;var a=c.length;for(var b=0;b<a;b++){StylesheetFormatter.toggle(b)}}else{for(var b=0;b<cssFiles.length;b++){StylesheetFormatter.toggle(cssFiles[b])}}},toggleDirection:function(){var t=["prefwindow","errorwindow",".browsebutton div",".browsebutton div div",".htmlbutton",".menu",".menu div",".menusmall div"];var p=document.styleSheets;var o=p.length;for(var n=0;n<o;n++){var c;if(jQuery.browser.msie){c=p[n].rules}else{c=p[n].cssRules}var d=c.length;for(var k=0;k<d;k++){if(c[k].style){var q=c[k].style;var m=c[k].selectorText;if($.inArray(m.toLowerCase(),t)==-1){if(jQuery.browser.msie){if(q.styleFloat){if(q.styleFloat=="left"){q.styleFloat="right"}else{if(q.styleFloat=="right"){q.styleFloat="left"}}}}else{if(q.cssFloat){if(q.cssFloat=="left"){q.cssFloat="right"}else{if(q.cssFloat=="right"){q.cssFloat="left"}}}}var s=q.marginLeft;var f=q.marginRight;q.marginLeft="";q.marginRight="";if(s){q.marginRight=s}if(f){q.marginLeft=f}var u=q.paddingLeft;var h=q.paddingRight;q.paddingLeft=null;q.paddingRight=null;if(u){q.paddingRight=u}if(h){q.paddingLeft=h}var g=q.left;var e=q.right;q.left="";q.right="";if(g!=""){q.right=g}if(e!=""){q.left=e}var b=q.textAlign;if(b=="left"){q.textAlign="right"}else{if(b=="right"){q.textAlign="left"}}var a=q.borderLeft;var v=q.borderRight;q.borderLeft="";q.borderRight="";if(a){q.borderRight=a}if(v){q.borderLeft=v}}}}}}};var HelpManager={visisble:false,initialize:function(){var a=$("<div id='helpWindow'><div id='helpWindowControls'><span id='helpWindowIcon'></span><span id='helpWindowTitle'></span><span id='helpWindowCloseButton'></span></div><div id='helpWindowTop'></div><div id='helpWindowMiddle'><iframe id='helpWindowContent' frameborder='no'></iframe></div><div id='helpWindowBottom'></div><span id='helpWindowTab'><span id='helpWindowTabText'></span></span></div>");EventDispatcher.addEventListener(Localization.events.localeChange,function(){a.find("#helpWindowTitle, #helpWindowTab > #helpWindowTabText").text(ResourceManager.getString("userdetails_help"))});$("body").append(a);$("#helpWindowCloseButton").click(function(){HelpManager.close()});$(".helpText").bind("click",function(){EventDispatcher.dispatchEvent("displayHelp")});$("#helpWindowTab").bind("click",function(){if(HelpManager.visisble){HelpManager.toggle()}else{getHelp()}});EventDispatcher.addEventListener("displayHelp",function(){if(CommonContext.standalone){if(typeof(Messenger.messageHandler)=="function"){Messenger.messageHandler(createRequestMessage("help"))}}else{if($("li.activeOpenItem").length>0){var b=$("li.activeOpenItem").attr("id").replace(OpenItems.openItemMarker,"");ChannelManager.send(createRequestMessage("help"),b)}}})},close:function(){$("#helpWindow").animate({top:-344},500);HelpManager.visisble=false;$("#helpWindowCloseButton").removeClass("open");$("#helpWindowCloseButton").addClass("closed");$("#helpWindow").draggable("disable")},showHelpByURL:function(a){$("#helpWindowContent").attr("src",a);HelpManager.showHelpWindow()},showHelpWindow:function(){$("#helpWindow").animate({top:-3},500);HelpManager.visisble=true;$("#helpWindowCloseButton").removeClass("closed");$("#helpWindowCloseButton").addClass("open");$("#helpWindow").draggable({iframeFix:"true",containment:"document"})},toggle:function(){if(helpWindowVisible){HelpManager.close()}else{HelpManager.show()}}};var ResourceManager={bundles:[],defaultResourceBundle:"common-platform",endpoint:"/js/locale",locale:null,addResourceBundle:function(a){if(a&&typeof(a)=="string"){if(!ResourceManager.locale){ResourceManager.bundles.push(new ResourceBundle(a,null,null));return}$.ajax({url:ResourceManager.endpoint+"/"+ResourceManager.locale+"/"+a+".xml",type:"GET",error:function(b){ServiceManager.get(ResourceManager.endpoint+"/"+ResourceManager.locale.substr(0,2)+"/"+a+".xml",function(d){if(!d){return}var g=d.getElementsByTagName("Resource");var e=[];for(var c=0;c<g.length;c++){if(!g[c].attributes){continue}var f=new Resource();for(var h=0;h<g[c].attributes.length;h++){f[g[c].attributes[h].nodeName]=g[c].attributes[h].nodeValue}if(!f.key||!f.value){continue}e.push(f)}ResourceManager.bundles.push(new ResourceBundle(a,e,ResourceManager.locale));EventDispatcher.dispatchEvent(Localization.events.localeChange)})},success:function(c){if(!c){return}var f=c.getElementsByTagName("Resource");var d=[];for(var b=0;b<f.length;b++){if(!f[b].attributes){continue}var e=new Resource();for(var g=0;g<f[b].attributes.length;g++){e[f[b].attributes[g].nodeName]=f[b].attributes[g].nodeValue}if(!e.key||!e.value){continue}d.push(e)}ResourceManager.bundles.push(new ResourceBundle(a,d,ResourceManager.locale));EventDispatcher.dispatchEvent(Localization.events.localeChange)}})}},getString:function(b,c){if(!c){c=b;b=ResourceManager.defaultResourceBundle}for(var a=0;a<ResourceManager.bundles.length;a++){var d=ResourceManager.bundles[a];if(d.name==b&&d.content){for(var e=0;e<d.content.length;e++){if(d.content[e].key==c){return d.content[e].value}}}}},removeResourceBundle:function(b){for(var a=0;a<ResourceManager.bundles.length;a++){if(ResourceManager.bundles[a].name==b){ResourceManager.bundles.splice(a,1)}}},setLocale:function(b){ResourceManager.locale=b;for(var a=0;a<ResourceManager.bundles.length;a++){var c=ResourceManager.bundles[a].name;ResourceManager.removeResourceBundle(c);ResourceManager.addResourceBundle(c)}}};function ResourceBundle(b,c,a){this.name=b;this.content=c;this.locale=a}function Resource(a,b){this.key=a;this.value=b};