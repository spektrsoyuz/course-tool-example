var Messenger={commtype:"hash",channel:"about:blank",channelIframeSource:"/upcomm.html",supportedChannels:["hash","xdm"],supportsXDM:false,origin:"*",messageHandler:null,initialize:function(e){var a=null;var d=this;if(a){var b=a.getElementsByTagName("context");if(b.length>0){var c=XMLHelper.getElementData(b[0],"host");this.setCommunicationChannel(c)}}if(e){this.messageHandler=e}if(window.postMessage){this.commtype="xdm";this.supportsXDM=true;if(window.addEventListener){window.addEventListener("message",this.handleCrossDomainMessage,false)}else{window.attachEvent("onmessage",this.handleCrossDomainMessage,false)}}else{this.commtype="hash"}},setCommunicationChannel:function(b){this.channel=b+this.channelIframeSource;if(this.commtype=="hash"){var a=document.createElement("iframe");a.setAttribute("id","up_comm");a.setAttribute("name","up_comm");a.setAttribute("src","about:blank");a.style.display="none";document.body.appendChild(a)}},checkFragmentIdentifier:function(){var a=window.location.hash;if(a&&a.substr(1)!="none"){window.location.hash="none";return this.getXMLDocumentFromFragment(a)}else{return null}},pollFragmentIdentifier:function(){var a=Messenger.checkFragmentIdentifier();if(a){if(this.messageHandler){this.messageHandler(a)}else{ErrorManager.show("pollFragmentIdentifier: no messageHandler established!")}}},getXMLDocumentFromFragment:function(a){return this.string2xml(this.decode(a))},handleCrossDomainMessage:function(a){if(Messenger.messageHandler){Messenger.messageHandler(Messenger.string2xml(decodeURIComponent(encodeURIComponent(a.data))))}else{ErrorManager.show("handleCrossDomainMessage: no messageHandler established!")}},send:function(a){a=this.encode(a);switch(this.commtype){case"hash":try{document.getElementById("up_comm").src=this.channel+"#"+a}catch(b){ErrorManager.show("An exception occurred in the script. Error name: "+b.name+". Error message: "+b.message)}break;case"xdm":parent.postMessage(a,this.origin);break;default:ErrorManager.show("No communication method has been defined.");break}},load:function(a,b){EventDispatcher.addEventListener(a,b);message=createServiceCallMessage(a);Messenger.send(message)},xml2string:function(b){var c=navigator.appName;var a;if(c=="Microsoft Internet Explorer"){a=b.xml}else{a=(new XMLSerializer()).serializeToString(b)}return a},string2xml:function(b){var c=navigator.appName;var a;if(c=="Microsoft Internet Explorer"){a=new ActiveXObject("Microsoft.XMLDOM");a.async="false";a.loadXML(b)}else{a=(new DOMParser()).parseFromString(b,"text/xml")}return a},encode:function(a){return Encoder.encode(a)},decode:function(a){if(a.substring(0,1)=="#"){a=a.substr(1)}return Encoder.decode(a)}};function wrapMessage(a){return"<?xml version='1.0' encoding='utf-8'?><UDCMessage>"+a+"</UDCMessage>"}function createStyleMessage(){var b="<styles>";for(var a in Theme.custom.colors){b+="<style><name>"+a+"</name><value>"+Theme.custom.colors[a]+"</value></style>"}b+="</styles>";return b}function createRequestMessage(a){return wrapMessage("<request>"+a+"</request>")}function createHostMessage(a){return wrapMessage("<host>"+a+"</host>")}function createContextMessage(b){var c="";for(var a in b){c+="<"+a+">"+b[a]+"</"+a+">"}c="<context>"+c+"</context>";c+=createStyleMessage();return wrapMessage(c)}function createNameValuePairMessage(a){var b="";for(x in a){b+="<"+x+">"+a[x]+"</"+x+">"}return wrapMessage(b)}function broadcastHelpMessageByURL(a){Messenger.send(createHelpMessageByURL(a))}function createHelpMessageByURL(a){return wrapMessage("<help><url>"+a+"</url></help>")}function createNavigationMessageByLocation(a){return wrapMessage("<navigate><location>"+a+"</location></navigate>")}function createApplicationPageNavigationMessage(a){return wrapMessage("<navigate><page>"+a+"</page></navigate>")}function createStatusMessage(a){return wrapMessage("<status><message>"+a+"</message></status>")}function createErrorMessage(c){var b="";if(typeof(c)==="string"){b+="<error><message>"+c+"</message></error>"}else{if(c instanceof Array){for(var a=0;a<c.length;a++){if(typeof(c[a])==="string"){b+="<error><message>"+c[a]+"</message></error>"}else{b+="<error>";if(c[a].code){b+="<code>"+c[a].code+"</code>"}if(c[a].message){b+="<message>"+c[a].message+"</message>"}b+="</error>"}}}}return wrapMessage("<errors>"+b+"</errors>")}function createConfirmationMessage(e,c,d){var b="<title>"+e+"</title>";b+="<message>"+c+"</message>";b+="<responses>";for(var a=0;a<d.length;a++){b+='<response label="'+d[a].label+'" responseValue="'+d[a].response+'"/>'}b+="</responses>";return wrapMessage("<confirmation>"+b+"</confirmation>")}function createConfirmationResponseMessage(a){return wrapMessage("<confirmation><response>"+a+"</response></confirmation>")}function createServiceCallMessage(a){return wrapMessage("<service><url>"+a+"</url></service>")}function createServiceResponseMessage(a,b){return wrapMessage("<service><response>"+a+"</response><url>"+b+"</url></service>")}var Encoder={_keyString:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(c){var a="";var k,h,f,j,g,e,d="";var b=0;do{k=c.charCodeAt(b++);h=c.charCodeAt(b++);f=c.charCodeAt(b++);j=k>>2;g=((k&3)<<4)|(h>>4);e=((h&15)<<2)|(f>>6);d=f&63;if(isNaN(h)){e=d=64}else{if(isNaN(f)){d=64}}a=a+this._keyString.charAt(j)+this._keyString.charAt(g)+this._keyString.charAt(e)+this._keyString.charAt(d);k=h=f="";j=g=e=d=""}while(b<c.length);return a},decode:function(c){var a="";var k,h,f,j,g,e,d="";var b=0;c=c.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{j=this._keyString.indexOf(c.charAt(b++));g=this._keyString.indexOf(c.charAt(b++));e=this._keyString.indexOf(c.charAt(b++));d=this._keyString.indexOf(c.charAt(b++));k=(j<<2)|(g>>4);h=((g&15)<<4)|(e>>2);f=((e&3)<<6)|d;a=a+String.fromCharCode(k);if(e!=64){a=a+String.fromCharCode(h)}if(d!=64){a=a+String.fromCharCode(f)}k=h=f="";j=g=e=d=""}while(b<c.length);return a}};var CookieManager={DOMAIN:CookieConstants.domain,MAGELLAN_HOME_COOKIE:"sghe_magellan_home",MAGELLAN_COOKIE_MARKER:"sghe_magellan_",set:function(a,d,c,b){var a=CookieManager.MAGELLAN_COOKIE_MARKER+a;if(a==CookieManager.MAGELLAN_COOKIE_MARKER+"username"&&d!=null){document.cookie=a+"="+Encoder.encode(d)+"; path=/"}else{document.cookie=a+"="+d+"; path=/"}},get:function(a){var a=CookieManager.MAGELLAN_COOKIE_MARKER+a+"=";var d=document.cookie.split(";");for(var b=0;b<d.length;b++){var e=" "+d[b];while(e.charAt(0)==" "){e=e.substring(1,e.length);if(e.indexOf(a)==0){if(a==CookieManager.MAGELLAN_COOKIE_MARKER+"username="&&CommonContext.user!=null){if(e.substring(a.length,e.length)==Encoder.encode(CommonContext.user)){return CommonContext.user}else{return e.substring(a.length,e.length)}}else{return e.substring(a.length,e.length)}}}}return null},remove:function(a,b){var a=CookieManager.MAGELLAN_COOKIE_MARKER+a;document.cookie=a+"=; expires=-1; path=/"}};var ErrorManager={show:function(a){switch(typeof(a)){case"string":MessageProcessor.processMessage(Messenger.encode(createErrorMessage(a)));break;case"array":MessageProcessor.processMessage(Messenger.encode(createErrorMessage("got an array of error messages")));break;default:break}}};function EventListener(a,b){this.type=a;this.listener=b}EventListener.prototype.getType=function(){return this.type};EventListener.prototype.getListener=function(){return this.listener};var EventDispatcher={listeners:[],addEventListener:function(a,b){if(!(a instanceof EventListener)){a=new EventListener(a,b)}if(!EventDispatcher.hasEventListener(a)){EventDispatcher.listeners.push(a)}},dispatchEvent:function(b,c){for(var a=0;a<EventDispatcher.listeners.length;a++){if(EventDispatcher.listeners[a].getType()==b){EventDispatcher.listeners[a].getListener()(c)}}},hasEventListener:function(b){if(b instanceof EventListener){for(var a=0;a<EventDispatcher.listeners.length;a++){if(EventDispatcher.listeners[a].getType()==b.getType()&&EventDispatcher.listeners[a].getListener()==b.getListener()){return true}}}else{for(var a=0;a<EventDispatcher.listeners.length;a++){if(EventDispatcher.listeners[a].getType()==b){return true}}}return false},removeEventListener:function(b,c){for(var a=0;a<EventDispatcher.listeners.length;a++){if(EventDispatcher.listeners[a].getType()==b){EventDispatcher.listeners.splice(a,1);return true}}return false}};var XMLHelper={getElementData:function(a,b){var c=null;if(a.getElementsByTagName(b).length>0){if(a.getElementsByTagName(b)[0].textContent){c=a.getElementsByTagName(b)[0].textContent}else{c=a.getElementsByTagName(b)[0].text}}return c},getChildByIndex:function(a,c,b){var d=XMLHelper.getChildren(a,c);if(d&&d[b]){return d[b]}return null},getChildren:function(a,b){if(a.getElementsByTagName(b).length>0){return a.getElementsByTagName(b)}return null},getFirstChild:function(a,b){return XMLHelper.getChildByIndex(a,b,0)}};var StyleManager={getRule:function(b){var f=document.styleSheets;for(var a=0;a<f.length;a++){var c=f.item(a);var g=null;try{if(c.cssRules){g=c.cssRules}else{g=c.rules}for(var h=0;h<g.length;h++){if(typeof g.item(h).selectorText!="undefined"&&g.item(h).selectorText.toLowerCase()==b.toLowerCase()){return g.item(h)}}}catch(d){ErrorManager.show("An exception occurred in the script. Error name: "+d.name+". Error message: "+d.message)}}return null},getStyle:function(a,b){var c=StyleManager.getRule(a);if(c&&c.style&&c.style[b]){return c.style[b]}return null},setStyle:function(a,c,b){var d=StyleManager.getRule(a);if(!d){return}if(d.style){d.style[c]=b}}};var Theme={themes:{institution:{colors:{primary:StyleManager.getStyle("themes_institution_colors_primary","color"),secondary:StyleManager.getStyle("themes_institution_colors_secondary","color"),selection:StyleManager.getStyle("themes_institution_colors_selection","color"),interaction:StyleManager.getStyle("themes_institution_colors_interaction","color")},backgrounds:{primary:StyleManager.getStyle("themes_backgrounds_primary","background"),institutionLogo:StyleManager.getStyle("themes_backgrounds_institutionLogo","background")},text:{primary:{color:StyleManager.getStyle("themes_institution_text_primary_color","color")},secondary:{color:StyleManager.getStyle("themes_institution_text_secondary_color","color")}}},spring:{colors:{primary:StyleManager.getStyle("themes_spring_colors_primary","color"),secondary:StyleManager.getStyle("themes_spring_colors_secondary","color"),selection:StyleManager.getStyle("themes_spring_colors_selection","color"),interaction:StyleManager.getStyle("themes_spring_colors_interaction","color")},backgrounds:{primary:StyleManager.getStyle("spring_backgrounds_primary","background"),institutionLogo:StyleManager.getStyle("spring_backgrounds_institutionLogo","background")},text:{primary:{color:StyleManager.getStyle("themes_spring_text_primary_color","color")},secondary:{color:StyleManager.getStyle("themes_spring_text_secondary_color","color")}}},summer:{colors:{primary:StyleManager.getStyle("themes_summer_colors_primary","color"),secondary:StyleManager.getStyle("themes_summer_colors_secondary","color"),selection:StyleManager.getStyle("themes_summer_colors_selection","color"),interaction:StyleManager.getStyle("themes_summer_colors_interaction","color")},backgrounds:{primary:StyleManager.getStyle("summer_backgrounds_primary","background"),institutionLogo:StyleManager.getStyle("summer_backgrounds_institutionLogo","background")},text:{primary:{color:StyleManager.getStyle("themes_summer_text_primary_color","color")},secondary:{color:StyleManager.getStyle("themes_summer_text_secondary_color","color")}}},fall:{colors:{primary:StyleManager.getStyle("themes_fall_colors_primary","color"),secondary:StyleManager.getStyle("themes_fall_colors_secondary","color"),selection:StyleManager.getStyle("themes_fall_colors_selection","color"),interaction:StyleManager.getStyle("themes_fall_colors_interaction","color")},backgrounds:{primary:StyleManager.getStyle("fall_backgrounds_primary","background"),institutionLogo:StyleManager.getStyle("fall_backgrounds_institutionLogo","background")},text:{primary:{color:StyleManager.getStyle("themes_fall_text_primary_color","color")},secondary:{color:StyleManager.getStyle("themes_fall_text_secondary_color","color")}}},winter:{colors:{primary:StyleManager.getStyle("themes_winter_colors_primary","color"),secondary:StyleManager.getStyle("themes_winter_colors_secondary","color"),selection:StyleManager.getStyle("themes_winter_colors_selection","color"),interaction:StyleManager.getStyle("themes_winter_colors_interaction","color")},backgrounds:{primary:StyleManager.getStyle("winter_backgrounds_primary","background"),institutionLogo:StyleManager.getStyle("winter_backgrounds_institutionLogo","background")},text:{primary:{color:StyleManager.getStyle("themes_winter_text_primary","color")},secondary:{color:StyleManager.getStyle("themes_winter_text_secondary","color")}}},wild:{colors:{primary:StyleManager.getStyle("themes_wild_colors_primary","color"),secondary:StyleManager.getStyle("themes_wild_colors_secondary","color"),selection:StyleManager.getStyle("themes_wild_colors_selection","color"),interaction:StyleManager.getStyle("themes_wild_colors_interaction","color")},backgrounds:{primary:StyleManager.getStyle("wild_backgrounds_primary","background"),institutionLogo:StyleManager.getStyle("wild_backgrounds_institutionLogo","background")},text:{primary:{color:StyleManager.getStyle("themes_wild_text_primary","color")},secondary:{color:StyleManager.getStyle("themes_wild_text_secondary","color")}}},blueflowers:{colors:{primary:StyleManager.getStyle("themes_blueflowers_colors_primary","color"),secondary:StyleManager.getStyle("themes_blueflowers_colors_secondary","color"),selection:StyleManager.getStyle("themes_blueflowers_colors_selection","color"),interaction:StyleManager.getStyle("themes_blueflowers_colors_interaction","color")},backgrounds:{primary:StyleManager.getStyle("blueflowers_backgrounds_primary","background"),institutionLogo:StyleManager.getStyle("blueflowers_backgrounds_institutionLogo","background")},text:{primary:{color:StyleManager.getStyle("themes_blueflowers_text_primary","color")},secondary:{color:StyleManager.getStyle("themes_blueflowers_text_secondary","color")}}}},defaultTheme:"institution",currentThemeName:null,custom:{colors:{primary:StyleManager.getStyle("custom_colors_primary","color"),secondary:StyleManager.getStyle("custom_colors_secondary","color"),selection:StyleManager.getStyle("custom_colors_selection","color"),interaction:StyleManager.getStyle("custom_colors_interaction","color")},backgrounds:{primary:StyleManager.getStyle("custom_backgrounds_primary","background"),institutionLogo:StyleManager.getStyle("custom_backgrounds_institutionLogo","background")},text:{primary:{color:StyleManager.getStyle("custom_text_primary_color","color")},secondary:{color:StyleManager.getStyle("custom_text_secondary_color","color")}}},save:function(){CookieManager.set("theme",Theme.currentThemeName);for(var a in Theme.custom.colors){CookieManager.set("color_"+a,Theme.custom.colors[a])}for(var a in Theme.custom.backgrounds){CookieManager.set("bg_"+a,Theme.custom.backgrounds[a])}for(var a in Theme.custom.text){for(var b in Theme.custom.text[a]){CookieManager.set("text_"+a+"_"+b,Theme.custom.text[a][b])}}},getTheme:function(a){return Theme.themes[a]},getDefaultTheme:function(){for(var a in Theme.themes){if(Theme.defaultTheme==a){return Theme.themes[a]}}return false},load:function(){var d=CookieManager.get("theme");if(!d){Theme.setTheme(Theme.defaultTheme)}else{if(d!="custom"&&Theme.getTheme(d)){Theme.setTheme(d);return}}for(var a in Theme.custom.colors){var c=CookieManager.get("color_"+a);if(c){Theme.custom.colors[a]=c;switch(a){case"primary":Theme.setPrimaryColor();$("#primaryColorSelector").ColorPickerSetColor(Theme.custom.colors.primary);break;case"secondary":Theme.setSecondaryColor();$("#secondaryColorSelector").ColorPickerSetColor(Theme.custom.colors.secondary);break;case"selection":Theme.setSelectionColor();$("#selectionColorSelector").ColorPickerSetColor(Theme.custom.colors.selection);break;case"interaction":Theme.setInteractionColor();$("#interactionColorSelector").ColorPickerSetColor(Theme.custom.colors.interaction);break;case"text":default:break}}}for(var a in Theme.custom.backgrounds){var b=CookieManager.get("bg_"+a);if(b){Theme.custom.backgrounds[a]=b}switch(a){case"primary":Theme.updateHeaderImage();break;case"institutionLogo":Theme.updateInstitutionalLogoImage();break;default:break}}for(var a in Theme.custom.text){for(var f in Theme.custom.text[a]){var e=CookieManager.get("text_"+a+"_"+f);if(e){Theme.custom.text[a][f]=e}switch(a){case"primary":if(f=="color"){Theme.setTextPrimaryColor();$("#primaryTextColorSelector").ColorPickerSetColor(Theme.custom.text.primary.color);break}break;case"secondary":if(f=="color"){Theme.setTextSecondaryColor();$("#secondaryTextColorSelector").ColorPickerSetColor(Theme.custom.text.secondary.color);break}break;default:break}}}},setTheme:function(e){var g=Theme.getTheme(e);if(!g){return}Theme.currentThemeName=e;if(g.colors){var i=g.colors;for(var d in i){switch(d){case"primary":Theme.setPrimaryColor(i[d]);$("#primaryColorSelector").ColorPickerSetColor(i[d]);break;case"secondary":Theme.setSecondaryColor(i[d]);$("#secondaryColorSelector").ColorPickerSetColor(i[d]);break;case"selection":Theme.setSelectionColor(i[d]);$("#selectionColorSelector").ColorPickerSetColor(i[d]);break;case"interaction":Theme.setInteractionColor(i[d]);$("#interactionColorSelector").ColorPickerSetColor(i[d]);break;default:break}}}if(g.backgrounds){var a=g.backgrounds;for(var d in a){switch(d){case"primary":Theme.updateHeaderImage(a[d]);break;case"institutionLogo":Theme.updateInstitutionalLogoImage(a[d]);break;default:break}}}if(g.text){var f=g.text;for(var d in f){for(var h in f[d]){switch(h){case"color":if(d=="primary"){Theme.setTextPrimaryColor(f[d][h])}else{if(d=="secondary"){Theme.setTextSecondaryColor(f[d][h])}}break;default:break}}}}MessageProcessor.broadcast(wrapMessage(createStyleMessage()))},resetPrimaryColor:function(){Theme.setPrimaryColor(Theme.getTheme().primary);MessageProcessor.broadcast(wrapMessage(createStyleMessage()))},resetSecondaryColor:function(){Theme.setSecondaryColor(Theme.getDefaultTheme().colors.secondary);MessageProcessor.broadcast(wrapMessage(createStyleMessage()))},resetSelectionColor:function(){Theme.setSelectionColor(Theme.getDefaultTheme().colors.selection);MessageProcessor.broadcast(wrapMessage(createStyleMessage()))},resetInteractionColor:function(){Theme.setInteractionColor(Theme.getDefaultTheme().colors.interaction);MessageProcessor.broadcast(wrapMessage(createStyleMessage()))},resetTextPrimaryColor:function(){Theme.setTextPrimaryColor(Theme.getDefaultTheme().text.primary.color);MessageProcessor.broadcast(wrapMessage(createStyleMessage()))},resetTextSelectionColor:function(){Theme.setTextSecondaryColor(Theme.getDefaultTheme().text.secondary.color);MessageProcessor.broadcast(wrapMessage(createStyleMessage()))},setPrimaryColor:function(a){if(a){Theme.custom.colors.primary="#"+a.replace("#","")}StyleManager.setStyle("#header","backgroundColor",Theme.custom.colors.primary);$("#primaryColorSelector div").css("backgroundColor",Theme.custom.colors.primary)},updateHeaderImage:function(a){if(a){Theme.custom.backgrounds.primary=a}var b=StyleManager.getStyle("#header","backgroundColor");StyleManager.setStyle("#header","background",Theme.custom.backgrounds.primary);StyleManager.setStyle("#header","backgroundColor",b)},updateInstitutionalLogoImage:function(a){if(a){Theme.custom.backgrounds.institutionLogo=a}var b=StyleManager.getStyle(".institutionalBranding","backgroundColor");StyleManager.setStyle(".institutionalBranding","background",Theme.custom.backgrounds.institutionLogo);StyleManager.setStyle(".institutionalBranding","backgroundColor",b)},setInteractionColor:function(a){if(a){Theme.custom.colors.interaction="#"+a.replace("#","")}StyleManager.setStyle(".navList > .parent > span:hover","backgroundColor",Theme.custom.colors.interaction);StyleManager.setStyle(".navList > .scrollableListItem > span:hover","backgroundColor",Theme.custom.colors.interaction);$("#interactionColorSelector div").css("backgroundColor",Theme.custom.colors.interaction)},setSelectionColor:function(a){if(a){Theme.custom.colors.selection="#"+a.replace("#","")}StyleManager.setStyle(".selectedListItem > span","backgroundColor",Theme.custom.colors.selection);$("#selectionColorSelector div").css("backgroundColor",Theme.custom.colors.selection)},setSecondaryColor:function(a){if(a){Theme.custom.colors.secondary="#"+a.replace("#","")}StyleManager.setStyle(".footerOpenItemsIcon","backgroundColor",Theme.custom.colors.secondary);$("#secondaryColorSelector div").css("backgroundColor",Theme.custom.colors.secondary)},setTextPrimaryColor:function(a){if(a){Theme.custom.text.primary.color="#"+a.replace("#","")}StyleManager.setStyle(".information span","color",Theme.custom.text.primary.color);$("#primaryTextColorSelector div").css("backgroundColor",Theme.custom.text.primary.color)},setTextSecondaryColor:function(a){if(a){Theme.custom.text.secondary.color="#"+a.replace("#","")}StyleManager.setStyle("#areasMenu > li > #workspaceText","color",Theme.custom.text.secondary.color);$("#secondaryTextColorSelector div").css("backgroundColor",Theme.custom.text.secondary.color)}};